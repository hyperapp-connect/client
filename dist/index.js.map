{"version":3,"file":"index.js","sources":["../src/ws.js","../src/mapActions.js","../src/index.js"],"sourcesContent":["let ws = {}\n\nexport const cache = []\nexport let open = false\nexport let apiVersion = \"v0\"\n\nlet error = (...msg) => console.error(...msg)\n\nconst isString = o => typeof o === \"string\"\nconst isFunction = o => typeof o === \"function\"\n\nconst stringify = msg => {\n  try {\n    if (isString(msg)) {\n      msg = JSON.parse(msg)\n    }\n\n    msg[0] = `${apiVersion}.${msg[0]}`\n\n    return JSON.stringify(msg)\n  } catch (e) {\n    error(e)\n  }\n}\n\nconst parse = msg => {\n  if (!isString(msg)) {\n    return msg\n  }\n\n  try {\n    return JSON.parse(msg)\n  } catch (e) {\n    return msg\n  }\n}\n\nconst reactions = actions => ({\n  onmessage: e => {\n    if (e.data === \"Unknown Action\") {\n      error(\"Unknown Action\", e)\n      return\n    }\n\n    const [path, data] = parse(e.data)\n    let action = actions\n\n    path.split(\".\").forEach(key => {\n      const fnName = `${key}_done`\n      const sub = action[fnName]\n      if (isFunction(sub)) {\n        action = sub\n        return\n      } else {\n        action = actions[key]\n      }\n    })\n\n    if (isFunction(action)) {\n      return action(data)\n    }\n  },\n  open: () => {\n    open = true\n\n    while (cache.length) {\n      const msg = cache.shift()\n      send(msg)\n    }\n  },\n  close: () => {\n    open = false\n  }\n})\n\nexport const connect = (actions, options = {}) => {\n  const host = options.host || location.hostname\n  const port = options.port || location.port\n  const protocol = options.protocol || \"ws\"\n\n  apiVersion = options.apiVersion || \"v0\"\n  error = options.error || error\n\n  ws = new WebSocket(`${protocol}://${host}:${port}`)\n\n  open = false\n\n  const react = reactions(actions)\n\n  ws.onopen = react.open\n  ws.onclose = react.close\n  ws.onmessage = react.onmessage\n\n  return ws\n}\n\nexport const send = msg => (open ? ws.send(stringify(msg)) : cache.push(msg))\n\nexport default connect\n","import { send } from \"./ws\"\n\nexport const map = (actions = {}, remote = {}, parent = null) => {\n  Object.keys(remote).forEach(name => {\n    const action = remote[name]\n\n    if (typeof action === \"function\") {\n      actions[name + \"_done\"] = action\n\n      actions[name] = (state, actions) => data => {\n        const key = parent ? `${parent}.${name}` : name\n        const msg = [key, data].filter(e => !!e)\n\n        send(msg)\n      }\n\n      return\n    }\n\n    if (typeof action === \"object\") {\n      const remoteActions = map({}, action, name)\n      actions[name] = Object.assign({}, actions[name], remoteActions)\n      return\n    }\n  })\n\n  return actions\n}\n\nexport default map\n","import map from \"./mapActions\"\nimport socket from \"./ws\"\n\n// default action for connected actions.\n// will expect the response from the server to be a slice of the state.\n// this slice will then be updated.\nexport const rem = res => () => res\n\nexport const connect = socket\nexport const mapActions = map\n"],"names":["connect","socket"],"mappings":"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"}